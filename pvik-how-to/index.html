<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1" />
	    <title>Pvik HowTo</title>
	<link rel="stylesheet" type="text/css" href="css/reset.css" ></link>
	<link rel="stylesheet" type="text/css" href="css/sh-core.css" ></link>
	<link rel="stylesheet" type="text/css" href="css/sh-theme-default.css" ></link>
	<link rel="stylesheet" type="text/css" href="css/general.css" ></link> 
	<script type="text/javascript" src="js/sh-core.js"></script>
	<script type="text/javascript" src="js/sh-brush-php.js"></script>
	<script type="text/javascript" src="js/sh-brush-xml.js"></script>
	<script type="text/javascript">
	     SyntaxHighlighter.all()
	</script>
</head>
<body>
<div id="global">
<div id="header">
<h1>Pvik HowTo</h1>
</div>
<div id="main">
<div id="menu">
<h2>Overview</h2>
<ul>
    <li><a href="#general">General</a></li>
    <li><a href="#requirements">Requirements</a></li>
    <li><a href="#install">Install</a></li>
    <li><a href="#naming-conventions">Naming conventions</a></li>
    <li><a href="#create-hello-world">Create hello world</a>
        <ul>
            <li><a href="#create-hello-world-1">Create a controller</a></li>
            <li><a href="#create-hello-world-2">Create a view</a></li>
            <li><a href="#create-hello-world-3">Register route</a></li>
        </ul>
    </li>
    <li><a href="#masterpage">Masterpage</a>
        <ul>
            <li><a href="#masterpage-1">Create masterpage</a></li>
            <li><a href="#masterpage-2">Create view</a></li>
        </ul>
    </li>
    <li><a href="#routing">Routing</a></li>
    <li><a href="#pass-data-from-controller-to-view">Pass data from controller to view</a></li>
    <li><a href="#model">Model</a>
    <ul>
            <li><a href="#model-1">Prepare configuration</a></li>
            <li><a href="#model-2">Create model classes</a></li>
            <li><a href="#model-3">Use model in controller</a></li>
            <li><a href="#model-4">Use model in view</a></li>
            <li><a href="#model-5">Insert</a></li>
            <li><a href="#model-6">Update</a></li>
            <li><a href="#model-7">Delete</a></li>
        </ul>
    </li>
    <li><a href="#model-array">ModelArray</a>
    <ul>
            <li><a href="#model-array-1">Sorting</a></li>
            <li><a href="#model-array-2">Filtering</a></li>
            <li><a href="#model-array-3">Perfomance</a></li>
        </ul>
    </li>
    <li><a href="#redirecting">Redirecting</a></li>
    <li><a href="#logging">Logging</a></li>
    <li><a href="#keyvaluearray">KeyValueArray</a></li>
    <li><a href="#auto-code-include">Auto code include</a></li>
    <li><a href="#deny-access-to-folder">Deny access to folder</a></li>
    <li><a href="#paths">Paths</a></li>
    <li><a href="#exceptions">Exceptions</a></li>
    <li><a href="#validation">Validation</a></li>
    <li><a href="#under-construction">Under Construction</a></li>
</ul>
</div>
<div id="content">
<h2 id="general">General</h2>
<p>
    Pvik uses the MVC concept, that divides applications into model, view and controller.
    You need to understand the concept before you working with Pvik. You find the different
    parts in the folder '/model/', '/views/' and '/controllers/'. Pvik use advanced urls which
    are called routes. If a route gets called the route calls the assigned action method from the
    assigned controller. You find the configuration file 'config.php' in the folder '/configs/'.
    This documentation is for the Pvik version 2.1.0.
    
</p>
<h2 id="requirements">Requirements</h2>
<p>You need a webserver (Apache2 recommended) with installed PHP5. You need permissions to overwrite the access controlling via a .htaccess file. RewriteEngine must be activated.</p>
<p>Pvik supports MySQL and MS SQL Server, but a database is not necessary to work with Pvik.</p>
<h2 id="install">Install</h2>
<p>To install Pvik you just need to copy the files to the webserver folder. If you use logging you need to set write permissions for the folder '/logs/'.</p>
<h2 id="naming-conventions">Naming conventions</h2>
<p>Folder and files are in small letters and words are separated through a dash. Code, like variables, classes and methods begins with a capital letter and uses camel casing.</p>
<pre class="brush: html"> 
# file and folders
/controllers/first-page-controller.php
/views/first-page/add-comment.php
/some-folder/test.php

# variables, classes methods and more
MyNewClass #class
FullName #variable
ConvertSomething #method
</pre>
<h2 id="create-hello-world">Create hello world</h2>
<p>Basis is a empty pvik template.</p>
<h3 id="create-hello-world-1">Create a controller</h3>
<p>Create the file 'hello-world-controller.php' in the folder '/controller/' with following content:</p>
<pre class="brush: php">
&lt;?php
class HelloWorldController extends Controller {
	// action					
	public function Index(){
		// place here the program logic
		$this-&gt;ExecuteView();
	}				
}
?&gt;</pre>
<h3 id="create-hello-world-2">Create a view</h3>
<p>Create the folder 'hello-world' in the folder '/views/'. Create the file 'index.php' in the folder '/views/hello-world/' with follwing content:</p>
<pre class="brush: php; html-script: true">
&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;
       &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Hello World&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Hello World&lt;/h1&gt;
&lt;?php
	// place php code here
?&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
<h3 id="create-hello-world-3">Register route</h3>
<p>Open the file 'config.php' in the folder '/configs/' and add following code to the end:</p>
<pre class="brush: php">self::$Config[&#39;Routes&#39;] = array (
    array (&#39;Url&#39; =&gt; &#39;/&#39;, &#39;Controller&#39; =&gt; &#39;HelloWorld&#39;, &#39;Action&#39; =&gt; &#39;Index&#39;)
);</pre>
<p>Open the website and you will see your 'Hello World' page.</p>
<h2 id="masterpage">Masterpage</h2>
<h3 id="masterpage-1">Create masterpage</h3>
<p>Create the folder 'master-pages' in the folder '/views/'. Create the file 'master.php' in the folder '/views/master-pages/' with follwing content:</p>
<pre class="brush: php; html-script: true">&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;
       &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Hello World&lt;/title&gt;
&lt;?php $this-&gt;UseContent(&#39;Head&#39;); ?&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Hello World&lt;/h1&gt;
&lt;?php $this-&gt;UseContent(&#39;Content&#39;); ?&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
<h3 id="masterpage-2">Create view</h3>
<p>Update the 'index.php' in the folder '/views/hello-world/' to following content:</p>
<pre class="brush: php; html-script: true">&lt;?php $this-&gt;UseMasterPage(&#39;~/views/master-pages/master.php&#39;); ?&gt;
&lt;?php $this-&gt;StartContent(&#39;Head&#39;); ?&gt;
	&lt;style&gt;
	h1 {color:red;}
	&lt;/style&gt;
&lt;?php $this-&gt;EndContent(); ?&gt;
&lt;?php $this-&gt;StartContent(&#39;Content&#39;); ?&gt;
	&lt;p&gt;
	Any Html Content here or use &lt;?php echo &#39;PHP&#39;; ?&gt;.
	&lt;/p&gt;
&lt;?php $this-&gt;EndContent(); ?&gt;</pre>
<h2 id="routing">Routing</h2>
<p>You can set a routing table via the configuration file. Use the 'Routes' array to register routes. Every route have to have a 'Url', 'Controller' and 'Action' attribute.
The attribute names are case sensitive. 'Url' contains the relative url (lowercase, start and end with /). You can set parameter via '{parameter}',
the parameter is named after the content between the brackets. E.g.: the name of '{id}' is 'id'. If you want to
set a restriction of the parameter you can use the 'Parameters' attribute that is a associated array. Key is the
parameter name and value is a regular expression. 'Controller' contains the name of the controller without the suffix
'Controller'. 'Action' contains the action method name. A route table could look like this:</p>
<pre class="brush: php">self::$Config[&#39;Routes&#39;] = array (
    array (&#39;Url&#39; =&gt; &#39;/&#39;, &#39;Controller&#39; =&gt; &#39;Index&#39;, &#39;Action&#39; =&gt; &#39;Index&#39;),
    array (&#39;Url&#39; =&gt; &#39;/route/&#39;, &#39;Controller&#39; =&gt; &#39;Index&#39;, &#39;Action&#39; =&gt; &#39;Index&#39;),
    array (&#39;Url&#39; =&gt; &#39;/route/{parameter}/&#39;, &#39;Controller&#39; =&gt; &#39;Index&#39;, &#39;Action&#39; =&gt; &#39;IndexWithParameters&#39;),
    array (&#39;Url&#39; =&gt; &#39;/route/{parameter}/&#39;, &#39;Controller&#39; =&gt; &#39;Index&#39;, &#39;Action&#39; =&gt; &#39;IndexWithParameters&#39;,
            &#39;Parameters&#39; =&gt; array (&#39;parameter&#39; =&gt; &quot;/^\d*$/&quot;)
        )
);</pre>
<p>You can read a parameter in the controller with following code:</p>
<pre class="brush: php">$this-&gt;Parameters-&gt;Get(&#39;parameter&#39;);</pre>
<h2 id="pass-data-from-controller-to-view">Pass data from controller to view</h2>
<p>
    You can pass data from controller to view via the KeyValueArray 'ViewData'.
    The controller code to set the view data could look like this:
</p>
<pre class="brush: php">$this-&gt;ViewData-&gt;Set(&#39;id&#39; , 1);
$this-&gt;ViewData-&gt;Set(&#39;text&#39; , &#39;this is a text&#39;);
$Instance = new Foo();
$this-&gt;ViewData-&gt;Set(&#39;instance&#39; , $Instance);</pre>
<p>
    To read the data using following code in the view:
</p>
<pre class="brush: php">$this-&gt;ViewData-&gt;Get(&#39;id&#39;);</pre>
<p class="info">Info: If you use a master page you have also access to the ViewData.</p>
<h2 id="model">Model</h2>
<p>
    Using model classes is a simple way to access data on a mysql server and prevent SQL Statements. 
    Pvik model use a simple cache controlling to prevent multiple database accesses if they aren't necessary.
</p>
<h3 id="model-1">Prepare configuration</h3>
<p> Add following lines to the config for a mysql connection and change the data for the connection if necessary:</p>
<pre class="brush: php">self::$Config['MySQL']['Server'] = 'localhost';
self::$Config['MySQL']['Username'] = 'root';
self::$Config['MySQL']['Password'] = 'root';
self::$Config['MySQL']['Database'] = 'mydatabase';</pre>
<p>
    Pvik also supports MS SQL Server, you can connect via the mssql driver or via sqlsrv driver. Check your php.ini to know which one is activated.
</p>
<pre class="brush: php">self::$Config['MSSQL']['Server'] = 'localhost';
self::$Config['MSSQL']['Username'] = 'root';
self::$Config['MSSQL']['Password'] = 'root';
self::$Config['MSSQL']['Database'] = 'mydatabase';
// or
self::$Config['SQLSRV']['Server'] = 'localhost';
self::$Config['SQLSRV']['Username'] = 'root';
self::$Config['SQLSRV']['Password'] = 'root';
self::$Config['SQLSRV']['Database'] = 'mydatabase';
</pre>
<h3 id="model-2">Create model classes</h3>
<p>There are two types of classes you need to create. A 'ModelTable' class and a 'Model' class. A object of 'ModelTable'
contains all needed information about a table. A object of 'Model' contains all needed data from a single line in the table. For example we have following tables in the database:
</p>
<pre><code>Authors
- AuthorID (int, primarykey, auto increment)
- Firstname (text)
- Lastname (text)

Books
- BookID (int, primarykey, auto increment)
- Title (text)
- AuthorID (int)</code></pre>
<p>A model file (/model/author-model.php) for the author could look like this: </p>
<pre class="brush: php">&lt;?php
class AuthorsModelTable extends ModelTable {
    public function __construct(){
        // define the table name
        $this-&gt;TableName = &#39;Authors&#39;;
        // define the class name for the model
        // &#39;Model&#39; is the standard suffix: &#39;AuthorModel&#39;
        $this-&gt;ModelName = &#39;Author&#39;;
        // define the primarykey
        $this-&gt;PrimaryKeyName = &#39;AuthorID&#39;;
        // define a new attribute from type primary key
        $this-&gt;FieldDefinition[&#39;AuthorID&#39;] = array (&#39;Type&#39; =&gt; &#39;PrimaryKey&#39;);
        // define a new attribute from type normal (text, number, anything)
        $this-&gt;FieldDefinition[&#39;Firstname&#39;] =  array (&#39;Type&#39; =&gt; &#39;Normal&#39;);
        // define a new attribute from type normal (text, number, anything)
        $this-&gt;FieldDefinition[&#39;Lastname&#39;] =  array (&#39;Type&#39; =&gt; &#39;Normal&#39;);
        // define a new attribute from type many foreign object
        // this field contains an ModelArray from &#39;BookModel&#39;s that are associated with a author
        $this-&gt;FieldDefinition[&#39;Books&#39;] = array (&#39;Type&#39; =&gt; &#39;ManyForeignObjects&#39;, &#39;ModelTable&#39; =&gt; &#39;Books&#39;,&#39;ForeignKey&#39; =&gt; &#39;AuthorID&#39;);
    }
}
// this phpdoc is usefull for code completion
/**
 * @property int $AuthorID
 * @property string $Firstname
 * @property string $Lastname
 * @porperty ModelArray $Books
 */
class AuthorModel extends Model {
    public function __construct(){
        // define the class name for the model table
        // &#39;ModelTable&#39; is the standard suffix: &#39;AuthorsModelTable&#39;
        $this-&gt;ModelTableName = &#39;Authors&#39;;
    }
}
?&gt;</pre>
<p>And the model file for the book (/model/book-model.php):</p>
<pre class="brush: php">&lt;?php

class BooksModelTable extends ModelTable {

    public function __construct() {
        // define the table name
        $this-&gt;TableName = &#39;Books&#39;;
        // define the class name for the model
        // &#39;Model&#39; is the standard suffix: &#39;BookModel&#39;
        $this-&gt;ModelName = &#39;Book&#39;;
        // define the primarykey
        $this-&gt;PrimaryKeyName = &#39;BookID&#39;;
        // define a new attribute from type primary key
        $this-&gt;FieldDefinition[&#39;BookID&#39;] = array(&#39;Type&#39; =&gt; &#39;PrimaryKey&#39;);
        // define a new attribute from type normal (text, number, anything)
        $this-&gt;FieldDefinition[&#39;Title&#39;] = array(&#39;Type&#39; =&gt; &#39;Normal&#39;);
        // define a new attribute from type foreign key
        // this field contains the real id
        $this-&gt;FieldDefinition[&#39;AuthorID&#39;] = array(&#39;Type&#39; =&gt; &#39;ForeignKey&#39;, &#39;ModelTable&#39; =&gt; &#39;Authors&#39;);
        // define a new attribute from type foreign object
        // this field contains a object from type &#39;AuthorModel&#39;
        $this-&gt;FieldDefinition[&#39;Author&#39;] = array(&#39;Type&#39; =&gt; &#39;ForeignObject&#39;, &#39;ForeignKey&#39; =&gt; &#39;AuthorID&#39;);
    }

}

// this phpdoc is usefull for code completion
/**
 * @property int $BookID
 * @property string $Title
 * @property int $AuthorID
 * @property AuthorModel $Author
 */
class BookModel extends Model {

    public function __construct() {
        // define the class name for the model table
        // &#39;ModelTable&#39; is the standard suffix: &#39;BooksModelTable&#39;
        $this-&gt;ModelTableName = &#39;Books&#39;;
    }

}

?&gt;</pre>
<p class="info" >
    Info: If the primary key is a guid you can set it in the data definition ('IsGuid' =&gt; true).
</p>
<h3 id="model-3">Use model in controller</h3>
<p>An action in the controller to select data could look like this:</p>
<pre class="brush: php">public function Index(){
    // load one author by id
    $Author = ModelTable::Get(&#39;Authors&#39;)-&gt;LoadByPrimaryKey(&#39;1&#39;);
 
    // load all authors
    $Authors = ModelTable::Get(&#39;Authors&#39;)-&gt;LoadAll();
    // load all books
    $Books = ModelTable::Get(&#39;Books&#39;)-&gt;LoadAll();
 
    // select authors with firstname &#39;Peter&#39;
    $Query = new Query(&#39;Authors&#39;);
    $Query-&gt;SetConditions(&#39;WHERE Author.Firstname = &quot;%s&quot;&#39;);
    $Query-&gt;AddParameter(&#39;Peter&#39;);
    $AuthorsWithFirstnamePeter = $Query-&gt;Select();
    // The code above always runs a select statement on the database which 
    // actually is not neccessary because we already loaded all authors.
    // This checks just the already loaded authors without a database query
    $AuthorsWithFirstnamePeter = $Authors-&gt;FilterEquals(&#39;Firstname&#39;, &#39;Peter&#39;);
    
   
    // select a single author
    $Query = new Query(&#39;Authors&#39;);
    $Query-&gt;SetConditions(&#39;WHERE Author.Firstname = &quot;%s&quot; AND Author.Lastname = &quot;%s&quot;&#39;);
    $Query-&gt;AddParameter(&#39;Hans&#39;);
    $Query-&gt;AddParameter(&#39;Meier&#39;);
    $AuthorHansMeier = $Query-&gt;SelectSingle();
    // or
    $AuthorHansMeier = $Authors-&gt;FilterEquals(&#39;Firstname&#39;, &#39;Peter&#39;)-&gt;FilterEquals(&#39;Lastname&#39;, &#39;Meier&#39;)-&gt;GetFirst();
   
    // Notice:
    // Select functions always run a statement on the database
    // Load functions check the cache first and only if neccessary run a statement on the database
    
    
    // pass list to view
    $this-&gt;ViewData-&gt;Set(&#39;Authors&#39;, $Authors);
    $this-&gt;ViewData-&gt;Set(&#39;Books&#39;, $Books);
    // execute view
    $this-&gt;ExecuteView();
}</pre>
<p class="info" >
    Info: Never write parameters in the condition to prevent sql injections. Use the AddParameters function instead.<br /><br />
    Info: Write the table name in front of a field in a condition to prevent errors.
</p>
<h3 id="model-4">Use model in view</h3>
<p>A part of the view could look like this:</p>
<pre class="brush: php">&lt;?php
// get list from controller
$Authors = $this-&gt;ViewData-&gt;Get(&#39;Authors&#39;);
/* @var $Authors ModelArray */ // helpful for code completion
?&gt;
&lt;table&gt;
    &lt;tr&gt;&lt;th&gt;Firstname&lt;/th&gt;&lt;th&gt;Lastname&lt;/th&gt;&lt;th&gt;First Book&lt;/th&gt;&lt;/tr&gt;
    &lt;?php
    foreach($Authors as $Author){
        /* @var $Author AuthorModel */ // helpful for code completion
    ?&gt;
    &lt;tr&gt;
        &lt;td&gt;&lt;?php echo $Author-&gt;Firstname; ?&gt;&lt;/td&gt;
        &lt;td&gt;&lt;?php echo $Author-&gt;Lastname; ?&gt;&lt;/td&gt;
        &lt;td&gt;&lt;?php
            // have books
            if($Author-&gt;Books!=null){
                // first book
                echo $Author-&gt;Books[0]-&gt;Title;
            }
            ?&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;?php
    }
    ?&gt;
&lt;/table&gt;</pre>
<p>Or like this:</p>
<pre class="brush: php">&lt;?php
// get list from controller
$Books = $this-&gt;ViewData-&gt;Get(&#39;Books&#39;);
/* @var $Books ModelArray */ // helpful for code completion
?&gt;
&lt;table&gt;
    &lt;tr&gt;&lt;th&gt;Title&lt;/th&gt;&lt;th&gt;Author&lt;/th&gt;&lt;/tr&gt;
    &lt;?php
    foreach($Books as $Book){
        /* @var $Book BookModel */ // helpful for code completion
    ?&gt;
    &lt;tr&gt;
        &lt;td&gt;&lt;?php echo $Book-&gt;Title; ?&gt;&lt;/td&gt;
        &lt;td&gt;&lt;?php echo $Book-&gt;Author-&gt;Lastname; ?&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;?php
    }
    ?&gt;
&lt;/table&gt;</pre>
<p class="info">Info: Don't use 'isset($Author->Books)' instead of '$Author->Books!=null' because it will always return false.<br /></p>
<h3 id="model-5">Insert</h3>
<p>A insert action in a controller could look like this</p>
<pre class="brush: php">public function Insert(){
    // create new author instance
    $Author = new AuthorModel();
    $Author-&gt;Firstname = 'William';
    $Author-&gt;Lastname = 'Shakespeare';
    // insert
    $Author-&gt;Insert();

    // create new book instance
    $Book = new BookModel();
    $Book-&gt;Title = 'Romeo and Juliet'
    $Book-&gt;AuthorID =  $Author-&gt;AuthorID;
     // insert
    $Book-&gt;Insert();
}</pre>
<h3 id="model-6">Update</h3>
<p>A update action in a controller could look like this</p>
<pre class="brush: php">public function Update(){
    // get author instance
    $Author = ModelTable::Get('Author')-&gt;LoadByPrimaryKey('1');
    $Author-&gt;Firstname = 'William';
    // update
    $Author-&gt;Update();

    // change author from book
    $Book = ModelTable::Get('Book')-&gt;LoadByPrimaryKey('1');
    $Book-&gt;AuthorID =  '2'; // the $Book->Author object automatically gets changed
     // update 
    $Book-&gt;Update();
}</pre>
<h3 id="model-7">Delete</h3>
<p>A delete action in a controller could look like this</p>
<pre class="brush: php">public function Delete(){
    // get author instance
    $Author = ModelTable::Get(&#39;Delete&#39;)-&gt;LoadByPrimaryKey(&#39;1&#39;);
    // delete all books from author
    foreach($Author-&gt;Books as $Book){
        /* @var $Book BookModel */ // helpful for code completion
        // delete the book
        $Book-&gt;Delete();
    }
    // delete the author
    $Author-&gt;Delete();
}</pre>
<h2 id="model-array">ModelArray</h2>
<p>
    If you get a list from the 'ModelTable' class you get a object from 'ModelArray' which offers some useful functions. Also, you can create a object of ModelArray by yourself and because it extends the php class 'ArrayObject' it acts like a array.
</p>
<pre class="brush: php">
$List = new ModelArray();
// you can set the model table but it is only neccessary for some special functions
$List-&gt;SetModelTable(ModelTable::Get('Table'));
$List-&gt;append($ObjectOfAModel);
</pre>
<h3 id="model-array-1">Sorting</h3>
<p>
    You have some easy use sorting function, which sort the 'ModelArray'
</p>
<pre class="brush: php">
// sort ascending for the field name
$List-&gt;Sort('Name'); // same as $List-&gt;Sort('+Name');
// sort descending for the field name
$List-&gt;Sort('-Name');
// sort ascending for the field name and then title
$List-&gt;Sort('Name', 'Title');

// the list contains a ForeignObject and you can sort by it values
$List-&gt;Sort('Author-&gt;Name', 'Author-&gt;Publisher-&gt;Country-&gt;Name');
// or sort it descending and after title
$List-&gt;Sort('Author-&gt;Name', '-Author-&gt;Publisher-&gt;Country-&gt;Name', 'Title');
</pre>
<h3 id="model-array-2">Filtering</h3>
<p>A filter method returns a new filtered 'ModelArray'.</p>
<pre class="brush: php">
// these function should be self explaining
$FilteredList = $List-&gt;FilterEquals('IsVisible', true);
$FilteredList = $List-&gt;FilterNotEquals('Name', 'Test');
$FilteredList = $List-&gt;FilterHeigher('Number', 10);
$FilteredList = $List-&gt;FilterHeigherEquals('Number', 10);
$FilteredList = $List-&gt;FilterLower('Number', 10);
$FilteredList = $List-&gt;FilterLowerEquals('Number', 10);
$FilteredList = $List-&gt;FilterStartsWith('Name', 'A');
$FilteredList = $List-&gt;FilterEndsWith('Name', 'Z');
$FilteredList = $List-&gt;FilterContains('Name', 'foo');
$FilteredList = $List-&gt;FilterIn('Name', array ('Hans', 'Peter'));
$FilteredList = $List-&gt;FilterNotIn('Name', array ('Klaus', 'Karl'));

// you can also merge two lists
// this filter selects every item with none id or 1 or 2 as a id
$FilteredList = $List-&gt;FilterEquals('ID', null)->Merge($List-&gt;FilterIn('ID', array ('1', '2')));
</pre>
<h3 id="model-array-3">Performance</h3>
<p>
    Pvik supports lazy loading but sometimes you want to load all data just in one query.
    Imagine we have a list of 500 books and for every book we want to display the authors name. For every book a single request to the database would be executed.
    If the data are loaded once Pvik keeps them in the cache. So we just can call the 'LoadList' Method.
    That reduces the sql statements and increases the performance
</p>
<pre class="brush: php">// in this example we did not load
// authors from the database
// Pvik would execute a select statement for
// every time we access a new author that is not
// loaded in the cache yet

// this function loads all authors from the book list
// into the cache
$Books-&gt;LoadList(&#39;Author&#39;); // we can ignore the Author list that this function returns
foreach($Books as $Book){
    /* @var $Book BookModel */ // helpful for code completion
    echo $Book-&gt;Author-&gt;Name;
}
 
// you also can load other data
$Books-&gt;LoadList(&#39;Author-&gt;Publisher-&gt;Country&#39;)
foreach($Books as $Book){
    /* @var $Book BookModel */ // helpful for code completion
    echo $Book-&gt;Author-&gt;Publisher-&gt;Country-&gt;Name;
}
// even if it is a &#39;ManyForeignObject&#39;
$Books-&gt;LoadList(&#39;Buyers-&gt;Country&#39;)
foreach($Books as $Book){
    /* @var $Book BookModel */ // helpful for code completion
    foreach($Book-&gt;Buyers as $Buyer){
        /* @var $Buyer BuyerModel */ // helpful for code completion
        echo $Buyer-&gt;Country-&gt;Name;
    }
}</pre>
<h2 id="redirecting">Redirecting</h2>
<p>There are two ways for redirecting. Redirecting to a path or redirecting to a controller. If you redirect to a path the browser will redirect to the given page. The other redirect is a server inside redirect and the url in the browser stays the same.</p>
<pre class="brush: php">public function Redirect(){
    // redirect to IndexController and action Index with given parameters
    $this-&gt;RedirectToController('Index', 'Index');
}

public function Redirect2(){
    $UrlParameters = array ('ID' =&gt; '2');
    // redirect to IndexController and action Index and add a parameter
    $this-&gt;RedirectToControllerWithParameters('Index', 'Index', $UrlParameters);
}

public function Redirect3(){
    // redirect to a subpage
    $this-&gt;RedirectToPath('~/subpage/');
}
</pre>
<h2 id="logging">Logging</h2>
<p>For debbuging cases you should use logging. You will find the file in the '/logs/' folder. Enable logging in the config:</p>
<pre class="brush: php">// enable logging
self::$Config['Log']['On'] = true;
// use one log file (otherwise for every access a new log file will be created)
self::$Config['Log']['UseOneFile'] = true;</code></pre>
<h2 id="KeyValueArray">KeyValueArray</h2>
<p>You can use the class 'KeyValueArray' when you need an associated array as an object:</p>
<pre class="brush: php">// new array
$Array = new KeyValueArray();
$Array-&gt;Add('Key1', 'Something');
// with set you can set an existing key or add a new key
$Array-&gt;Set('AnotherKey', '');

if($Array-&gt;ContainsKey('Key1')){
    $Value = $Array-&gt;Get('Key1');
}
if(!$Array-&gt;IsNotEmpty('AnotherKey')){
    $Array-&gt;Remove('AnotherKey');
}

$Array-&gt;Set('Key1', 'Something New');</pre>
<h2 id="auto-code-include">Auto code include</h2>
<p>Pvik automatically include all php files in the folders '/core/', '/code/', '/model/' and '/controllers/'. You can change this in the config via:</p>
<pre class="brush: php">self::$Config['IncludeFolders'] = array ('~/core', '~/code', '~/model', '~/controllers');</pre>
<p>If a code file depends from a other file you should use this code to be sure that all files are included in the correct way:</p>
<pre class="brush: php">// file depends from other file (should be the first statement in the file)
Core::Depends('~/code/class-a.php');

class ClassB extends ClassA {

}</code></pre>
<h2 id="deny-access-to-folder">Deny access to folder</h2>
<p>You should deny access to sensitive folders via the .htaccess file by redirecting to the index.php file.
Pvik denys the access to the folder '/code/', '/config/', '/controllers/', '/core/', '/model/' and '/views/'.
Add this code to the .htaccess file to deny access to a folder ('/some-folder/' in this case):
</p>
<pre><code>RewriteRule ^some-folder\/.*$ index.php [L]</code></pre>
<h2 id="paths">Paths</h2>
<p>Pvik offers two methods to resolve paths. There a two different types of paths. A absolut path should be used for including php files. A relative path should be used for including stylesheet or link paths. '~/' will be replaced with the correct path. Absolut path:</p>
<pre class="brush: php">&lt;include(Core::RealPath('~/code/file.php'));</pre>
<p>Relative path:</p>
<pre class="brush: php; html-script: true">&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;
       &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot;
 href=&quot;&lt;?php echo Core::RelativePath(&#39;~/css/style.css&#39;); ?&gt;&quot;&gt;
&lt;!-- better use this methods--&gt;
&lt;?php Html::StyleSheetLink(&#39;~/css/style2.css&#39;); ?&gt;
&lt;?php Html::JavaScriptLink(&#39;~/js/jquery-1.6.1.min.js&#39;); ?&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;a href=&quot;&lt;?php echo Core::RelativePath(&#39;~/books/&#39;); ?&gt;&quot;&gt;Books&lt;/a&gt;
&lt;!-- better use this method--&gt;
&lt;?php Html::Link(&#39;~/authors/&#39;, &#39;Author&#39;); ?&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
<p>You should use the relative path methods to make sure that you have the correct path in any case like using Pvik in a subfolder.</p>
<h2 id="exceptions">Exceptions</h2>
<p>
    By default pvik opens after a unhandled exception the error masterpage ('/views/error-pages/master.php') which show a lot of usefull information.
    You can configure the exception handling via the config:
</p>
<pre class="brush: php">self::$Config[&#39;ErrorPages&#39;] = array (
    &#39;NoRouteFoundException&#39; =&gt; &#39;~/views/error-pages/no-route-found.php&#39;,
    &#39;Default&#39; =&gt; &#39;~/views/error-pages/master.php&#39;
);</pre>
<p>
    In this case we set a new errorpage for the 'NoRouteFoundException'. The errorpage could be a simple redirect to the index file:
</p>
<pre class="brush: php">&lt;?php
header(&quot;Location: &quot;. Core::RelativePath(&#39;~/&#39;));
?&gt;</pre>
<p>
    Or just print '404':
</p>
<pre class="brush: html">&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;
       &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;404&lt;/h1&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
<h2 id="validation">Validation</h2>
<p>
    Pivk offers a 'ValidationState' class which you can use if you want to validate fields.
    In this example we're validate data which we got via post:
</p>
<pre class="brush: php">if(Core::IsPOST(&#39;submit&#39;)){
    $Title = Core::GetPOST(&#39;title&#39;);
    $Date = Core::GetPOST(&#39;date&#39;);
    $ValidationState = new ValidationState();
    if(empty($Title)){
        $ValidationState-&gt;SetError(&#39;Title&#39;, &#39;Please enter a title.&#39;);
    }
    elseif(strlen($Title)&lt;3){
        $ValidationState-&gt;SetError(&#39;Title&#39;, &#39;The title must have at least 3 characters.&#39;);
    }

    if(empty($Date)){
        $ValidationState-&gt;SetError(&#39;Date&#39;, &#39;Please enter a date.&#39;);
    }
    //elseif([validation if it is a date]){
    //
    //}

    if($ValidationState-&gt;IsValid()){
        // do something
        // insert into table
    }

    //pass the validation state to the view
    $this-&gt;ViewData-&gt;Set(&#39;ValidationState&#39;, $ValidationState);
    $this-&gt;ExecuteView();
 }</pre>
<p>
    Because we pass the validation state to the view we can access it there and print error messages:
</p>
 <pre class="brush: php; html-script: true">&lt;form method=&quot;POST&quot; action=&quot;&quot;&gt;
    &lt;?php
    $ValidationState = $this-&gt;ViewData-&gt;Get(&#39;ValidationState&#39;);
    ?&gt;
    &lt;h3&gt;title&lt;/h3&gt;
    &lt;input type=&quot;text&quot; name=&quot;title&quot; class=&quot;field&quot; value=&quot;&quot;/&gt;&lt;br /&gt;
    &lt;?php
         // display error
         if($ValidationState-&gt;GetError(&#39;Title&#39;)!=null){
             echo $ValidationState-&gt;GetError(&#39;Title&#39;);
         }
    ?&gt;
    &lt;h3&gt;date&lt;/h3&gt;
    &lt;input type=&quot;text&quot; name=&quot;date&quot; class=&quot;field&quot; value=&quot;&quot;/&gt;&lt;br /&gt;
    &lt;!-- better use this method --&gt;
    &lt;?php Html::Errorfield($ValidationState, &#39;Title&#39;); ?&gt;
    &lt;!-- output is like: &lt;span class=&quot;errorfield&quot;&gt;Please enter a date.&lt;/span&gt;&#39;--&gt;
&lt;/form&gt;</pre>
<p class="info">
    Info: You should create a seperate validation class for all validation work.
</p>
<h2 id="under-construction">Under Construction</h2>
<p>
    If you want to update your website, by uploading new files to your webserver, you should activate the 'UnderConstruction' statei in the config. Every request will be redirect to the 'Under Construction' web page to prevent errors. 
</p>
<pre class="brush: php">self::$Config['UnderConstruction']['Enabled'] = false;</pre>
<p class="info">
    Info: Make sure that you updated the 'under-construction.php' in '/views/other/'.
</p>
<p>
    You can change the path to the web page by setting the 'path' value.
</p>
<pre class="brush: php">self::$Config['UnderConstruction']['Path'] = '~/views/other/under-construction.php';</pre>
</div>
</div>
</body>
</html>
